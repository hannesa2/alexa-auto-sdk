<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Alexa Auto SDK: AmazonLite Wake Word Extension</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="aace-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Alexa Auto SDK
   &#160;<span id="projectnumber">2.2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">AmazonLite Wake Word Extension </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Alexa Auto SDK AmazonLite Wake Word extension adds AmazonLite wake word support for Generic Linux (<code>native</code>), Android ARMv7a / ARMv8a / x86-64 (<code>androidarm</code> / <code>androidarm64</code> / <code>androidx86-64</code>), and QNX AArch64 / x86-64 (<code>qnx7arm64</code> / <code>qnx7x86-64</code>) targets.</p>
<blockquote class="doxtable">
<p><b>Note</b>: You must use this extension with the Alexa Auto SDK Builder. </p>
</blockquote>
<p><b>Table of Contents</b></p>
<ul>
<li><a href="#runtime-switching-of-the-wake-word-model">Runtime Switching of the Wake Word Model</a></li>
<li><a href="#installing-the-amazonlite-wake-word-extension">Installing the AmazonLite Wake Word Extension</a></li>
<li><a href="#building-the-auto-sdk-with-the-amazonlite-wake-word-extension">Building the Auto SDK with the AmazonLite Wake Word Extension</a></li>
<li><a href="#running-the-auto-sdk-with-the-amazonlite-wake-word-extension">Running the Auto SDK with the AmazonLite Wake Word Extension</a></li>
</ul>
<h2>Runtime Switching of the Wake Word Model</h2>
<p>AmazonLite optionally supports switching the wake word model when the AVS locale is switched. Enabling this feature requires <a href="#binary-format-locale-access">access to the binary format locale models on the target device</a> and <a href="#amazonlite-configuration">AmazonLite configuration</a>.</p>
<h3>Access to the Binary Format Locale Models on Target Device </h3>
<p>AmazonLite requires locale models in binary format on the target file system to support the runtime switching feature. These model files are part of the build artifact. You can find them at: <code>/opt/AAC/share/pryon-lite/models</code> inside the build artifact <code>aac-sdk-build-&lt;target&gt;.tar.gz</code> located at <code>builder/deploy/&lt;target&gt;</code>.</p>
<h3>Providing AmazonLite Configuration</h3>
<p>In addition to access to the locale models, the application must provide the <code>aace.amazonLite</code> configuration, which specifies the path where model files are stored and maps the wake word locale to these model files.</p>
<p>To programmatically pass the <code>aace.amazonLite</code> configuration see <a href="./modules/amazonlite/engine/include/AACE/Engine/AmazonLiteConfiguration.h">aace::engine::amazonLite::AmazonLiteConfiguration</a> class for more details. Or supply the configuration as outlined below.</p>
<div class="fragment"><div class="line">&quot;aace.amazonLite&quot;: {</div><div class="line">    &quot;rootPath&quot;: &quot;/path/to/models&quot;,</div><div class="line">    &quot;models&quot;: [</div><div class="line">        {</div><div class="line">            &quot;locale&quot;: &quot;en-US&quot;,</div><div class="line">            &quot;path&quot;: &quot;D.en-US.alexa.bin&quot;</div><div class="line">        },</div><div class="line">        {</div><div class="line">            &quot;locale&quot;: &quot;en-IN&quot;,</div><div class="line">            &quot;path&quot;: &quot;D.en-IN.alexa.bin&quot;</div><div class="line">        }</div><div class="line">        ...</div><div class="line">    ]</div><div class="line">    },</div></div><!-- fragment --><blockquote class="doxtable">
<p><b>Note</b>: For the most accurate internationalized wake word detection, we recommend that you have the wake word locale model for each supported Alexa locale. If a matching locale is not found/supplied then the AmazonLite Wake Word extension falls back to the default locale. </p>
</blockquote>
<blockquote class="doxtable">
<p><b>Note</b>: Optionally you may refer to <code>builder/deploy/[target]/opt/AAC/share/pryon_lite/models/localeToModels.json</code> for details on mapping locales to the model files. </p>
</blockquote>
<h2>Installing the AmazonLite Wake Word Extension</h2>
<p>Unzip the <code>amazonlite-2.2.zip</code> archive into the <code>${AAC_SDK_HOME}/extensions/extras</code> directory. For example:</p>
<div class="fragment"><div class="line">unzip amazonlite-2.2.zip -d aac-sdk/extensions/extras</div></div><!-- fragment --><blockquote class="doxtable">
<p><b>Note</b>: If the archive is already unzipped, simply move the <code>amazonlite</code> directory into the <code>aac-sdk/extensions/extras</code> directory. </p>
</blockquote>
<p>Your <code>aac-sdk/extensions/extras</code> directory structure should look something like this:</p>
<div class="fragment"><div class="line">aac-sdk</div><div class="line">└─ extensions</div><div class="line">   └─ extras</div><div class="line">      └─ amazonlite</div><div class="line">         └─ meta-aac-amazonlite</div><div class="line">            └─ conf</div><div class="line">               └─ layer.conf</div><div class="line">            └─ packages</div><div class="line">               ├─ pryon_lite_[version]-alexa-autocore-[date and build].zip</div><div class="line">               └─ avs-sdk-adapter-for-wakeword-lite-[version].tgz</div><div class="line">         └─ modules</div><div class="line">           └─ amazonlite</div><div class="line">              └─ configs</div><div class="line">                 └─ config-amazonlite.json.in</div><div class="line">           └─ engine</div><div class="line">           └─ platform</div><div class="line">         └─ platforms</div><div class="line">            └─ android</div><div class="line">         └─ LICENSE</div><div class="line">         └─ README.md</div></div><!-- fragment --><h2>Building the Auto SDK with the AmazonLite Wake Word Extension </h2>
<p>To enable wake word support with the default locale, build your target platform with the AmazonLite Wake Word extension. See below for build instructions for <a href="#building-for-android">Android</a>, <a href="#building-for-linux">Linux</a>, and <a href="#building-for-qnx">QNX</a> </p><h3>Overriding the Default Wake Word Model</h3>
<p>As a default option, AmazonLite is configured to a default wake word locale <code>en-US</code>.</p>
<p>To override this default locale, set the BitBake flag <code>AMAZONLITE_CPP_MODEL_NAME</code> to the desired locale model CPP file as found inside the <code>amazonlite/meta-aac-amazonlite/packages/pryon_lite-*/models/[format]</code></p>
<p>For example, to override the default wake word model to <code>en-IN</code>:</p>
<div class="fragment"><div class="line">builder/build.sh &lt;platform&gt; --target &lt;target&gt; extensions/extras/amazonlite -DAMAZONLITE_CPP_MODEL_NAME=D.en-IN.alexa.cpp</div></div><!-- fragment --><h3>Building the Auto SDK with the AmazonLite Wake Word Extension for Android </h3>
<p>Build your Android target with the <code>amazonlite</code> extension to enable wake word support.</p>
<p>For example:</p>
<div class="fragment"><div class="line">builder/build.sh android --target androidarm,androidx86-64 extensions/extras/amazonlite</div></div><!-- fragment --><p> Confirm that the Alexa Auto SDK Builder has added the extension by looking for the following lines in the initial console output:</p>
<div class="fragment"><div class="line">NOTE: SDK Version: [version]</div><div class="line">NOTE: Search for sub modules: /home/builder/aac/extensions/extras/amazonlite</div><div class="line">NOTE: Adding meta layer: /home/builder/aac/extensions/extras/amazonlite/meta-aac-amazonlite</div></div><!-- fragment --><h4>Enabling Wake Word Model Switching</h4>
<p>Complete the following steps if you want to enable an Android Sample App feature to enable wake word model switching:</p>
<ol type="1">
<li>Untar <code>aac-sdk-build-&lt;target&gt;.tar.gz</code> found at <code>builder/deploy/</code> and copy the required locale model binary files <code>(*.bin)</code> from <code>builder/deploy/[target]/opt/AAC/share/pryon_lite/models</code> to <code>${AAC_SDK_HOME}/samples/android/app/src/main/assets/models</code>.</li>
<li>Provide the <code>aace.amazonLite</code> AmazonLite configuration to the Engine by uncommenting this line of code in <a href="./samples/android/modules/sample-amazonlite/src/main/java/com/amazon/sampleapp/amazonlite/AmazonliteModuleFactory.java"><code>AmazonliteModuleFactory.java</code></a>:</li>
</ol>
<div class="fragment"><div class="line">Configuration.createAmazonLiteConfig(sampleAppContext.getData(SampleAppContext.MODEL_DIR), modelsInfoList));</div></div><!-- fragment --><ol type="1">
<li>Rebuild the Android target:</li>
</ol>
<div class="fragment"><div class="line">builder/build.sh android --target androidarm,androidx86-64 extensions/extras/amazonlite</div></div><!-- fragment --><h3>Building the Auto SDK with the AmazonLite Wake Word Extension for Linux</h3>
<p>Build your Linux target with the wake word extension to enable wake word support.</p>
<p>For example:</p>
<div class="fragment"><div class="line">builder/build.sh linux -t native extensions/extras/amazonlite</div></div><!-- fragment --><p>Confirm that the Alexa Auto SDK Builder has added the extension by looking for the following lines in the initial console output:</p>
<div class="fragment"><div class="line">NOTE: SDK Version: [version]</div><div class="line">NOTE: Search for sub modules: /home/builder/aac/extensions/extras/amazonlite</div><div class="line">NOTE: Adding meta layer: /home/builder/aac/extensions/extras/amazonlite/meta-aac-amazonlite</div></div><!-- fragment --><h4>Building the C++ Sample App with the AmazonLite Wake Word Extension</h4>
<p>Build the ../../samples/cpp/README.md "C++ Sample App" with the wake word extension to enable wake word support with the default locale.</p>
<div class="fragment"><div class="line">builder/build.sh linux -t native extensions/extras/amazonlite</div></div><!-- fragment --><p>Install the generated C++ Sample App package into <code>/opt/AAC</code>:</p>
<div class="fragment"><div class="line">$ sudo tar xf ${AAC_SDK_HOME}/builder/deploy/native/aac-sdk-build-native.tar.gz -C /</div></div><!-- fragment --><p>Run the ../../samples/cpp/README.md "C++ Sample App".</p>
<div class="fragment"><div class="line">$ /opt/AAC/bin/SampleApp --cbreak \</div><div class="line">                         --config /opt/AAC/etc/config.json \</div><div class="line">                         --menu   /opt/AAC/etc/menu.json </div></div><!-- fragment --><h5>Enabling Wake Word Model Switching</h5>
<p>Configure the ../../samples/cpp/README.md "C++ Sample App" with the <code>aace.amazonLite</code> config to enable run time switching of the wake word model. There are two ways to provide the config and run the Sample App:</p>
<h6>Option 1: Use the autogenerated config</h6>
<p>This is the easiest option, as it uses the config from <code>/opt/AAC/etc/config-amazonlite.json</code> which is generated at the build time using the <a href="./modules/amazonlite/configs/config-amazonlite.json.in">config-amazonlite.json.in</a> with default config values. Models here are assumed to be stored in the default <code>/opt/AAC/share/pryon-lite/models</code> location.</p>
<p>Use these commands to run the C++ Sample App with the autogenerated AmazonLite config:</p>
<div class="fragment"><div class="line">$ /opt/AAC/bin/SampleApp --cbreak \</div><div class="line">                         --config /opt/AAC/etc/config.json \</div><div class="line">                         --config /opt/AAC/etc/config-amazonlite.json \</div><div class="line">                         --menu   /opt/AAC/etc/menu.json &gt; SampleApp.log</div></div><!-- fragment --><h6>Option 2: Create a custom config file</h6>
<p>Alternatively you can provide the <code>aace.amazonLite</code> config by creating your own config file and passing it in when running the SampleApp. Copy the <a href="./modules/amazonlite/configs/config-amazonlite.json.in">config-amazonlite.json.in</a> file, rename it as <code>config-amazonlite.json</code>, and customize the config values. The config you create must follow the same JSON format as the <a href="./modules/amazonlite/configs/config-amazonlite.json.in">config-amazonlite.json.in</a> file. For example:</p>
<div class="fragment"><div class="line">{</div><div class="line">    &quot;aace.amazonLite&quot;: {</div><div class="line">        &quot;rootPath&quot;: &quot;/opt/AAC/share/pryon-lite/models&quot;,</div><div class="line">        &quot;models&quot;: [</div><div class="line">            {</div><div class="line">                &quot;locale&quot;: &quot;en-US&quot;,</div><div class="line">                &quot;path&quot;: &quot;D.en-US.alexa.bin&quot;</div><div class="line">            },</div><div class="line">            ...</div><div class="line">        ]</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><blockquote class="doxtable">
<p><b>Note:</b> Update the <code>rootPath</code> with the appropriate absolute path where the model files are stored. The above example reads the models from <code>/opt/AAC/share/pryon-lite/models</code>. </p>
</blockquote>
<p>Run the ../../samples/cpp/README.md "C++ Sample App" with the absolute path to the <code>config-amazonlite.json</code> file.</p>
<blockquote class="doxtable">
<p><b>NOTE</b> Before running the command update the <code>/path/to/config-amazonlite.json</code> to appropriate path where <code>config-amazonlite.json</code> is located. </p>
</blockquote>
<div class="fragment"><div class="line">$ /opt/AAC/bin/SampleApp --cbreak \</div><div class="line">                         --config /opt/AAC/etc/config.json \</div><div class="line">                         --config /path/to/config-amazonlite.json \</div><div class="line">                         --menu   /opt/AAC/etc/menu.json &gt; SampleApp.log</div></div><!-- fragment --><h3>Building the Auto SDK with the AmazonLite Wake Word Extension for QNX</h3>
<p>Build your QNX target with the AmazonLite Wake Word extension to enable wake word support.</p>
<p>For example:</p>
<div class="fragment"><div class="line">builder/build.sh qnx7 -t qnx7arm64 --qnx7sdp-path ${HOME}/qnx700 extensions/extras/amazonlite</div></div><!-- fragment --><p>Confirm that the Alexa Auto SDK Builder has added the extension by looking for the following lines in the initial console output:</p>
<div class="fragment"><div class="line">NOTE: SDK Version: [version]</div><div class="line">NOTE: Search for sub modules: /home/builder/aac/extensions/extras/amazonlite</div><div class="line">NOTE: Adding meta layer: /home/builder/aac/extensions/extras/amazonlite/meta-aac-amazonlite</div></div><!-- fragment --><h2>Running the Auto SDK with the AmazonLite Wake Word Extension</h2>
<h3>Running the Auto SDK with the AmazonLite Wake Word Extension on Android</h3>
<p>If the Android Sample App detects at launch that the SDK was built with wake word support, a Wake Word switch will appear in its control drawer, set <code>on</code> by default.</p>
<p>Open the Sample App in Android Studio, then run the app on your target device, log in, and start using the wake word: **"Alexa... What time is it?"**</p>
<p>In your implementation, your <code>SpeechRecognizerHandler</code> should start streaming microphone data with <code>startAudioInput()</code>, and stop with <code>stopAudioInput()</code>.</p>
<p>For example:</p>
<div class="fragment"><div class="line">public class SpeechRecognizerHandler extends SpeechRecognizer</div><div class="line">{</div><div class="line">    @Override</div><div class="line">    public boolean startAudioInput() {</div><div class="line">        // implement start recording</div><div class="line">    }</div><div class="line">    @Override</div><div class="line">    public boolean stopAudioInput() {</div><div class="line">        // implement stop recording</div><div class="line">    }</div><div class="line">    ...</div><div class="line">        // call the write audio method while reading audio input data</div><div class="line">        write( (byte[]) data, (long) size )</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><h3>Running the Auto SDK with the AmazonLite Wake Word Extension on Linux or QNX</h3>
<p>The <code>alexa</code> module detects wake word support, which can be enabled/disabled at instance creation, or later through <code>SpeechRecognizer</code> calls <code>enableWakewordDetection()</code> and <code>disableWakewordDetection()</code>.</p>
<p>You can also support enabling/disabling with an optional <code>wakewordDetectionEnabled</code> parameter in your <code>SpeechRecognizerHandler</code> constructor.</p>
<p>For example:</p>
<div class="fragment"><div class="line">SpeechRecognizerHandler::SpeechRecognizerHandler( bool wakewordDetectionEnabled = true )</div><div class="line">    : aace::alexa::SpeechRecognizer{ wakewordDetectionEnabled } { ... }</div></div><!-- fragment --><p>Additionally, your <code>SpeechRecognizerHandler</code> implementation should start streaming microphone data with <code>startAudioInput()</code>, and stop with <code>stopAudioInput()</code>.</p>
<p>For example:</p>
<div class="fragment"><div class="line">bool SpeechRecognizerHandler::startAudioInput() {</div><div class="line">    auto audioInput = m_audioInput.lock();</div><div class="line">    if (!audioInput) {</div><div class="line">        return false;</div><div class="line">    }</div><div class="line">    return audioInput-&gt;startStreamingMicrophoneData();</div><div class="line">}</div><div class="line"></div><div class="line">bool SpeechRecognizerHandler::stopAudioInput() {</div><div class="line">    auto audioInput = m_audioInput.lock();</div><div class="line">    if (!audioInput) {</div><div class="line">        return false;</div><div class="line">    }</div><div class="line">    return audioInput-&gt;stopStreamingMicrophoneData();</div><div class="line">}</div></div><!-- fragment --><p>The audio input writes microphone data as it becomes available (e.g. audio input callback) to the <code>SpeechRecognizerHandler</code> instance.</p>
<p>For example:</p>
<div class="fragment"><div class="line">ssize_t returnCode = speechRecognizerHandler-&gt;write(static_cast&lt;const int16_t *&gt;(inputBuffer), numSamples);</div></div><!-- fragment --> </div></div><!-- contents -->
<html>
  <body>
    <hr style="height:1px;border-width:0;color:gray;background-color:gray">
    <p style="text-align:left;">
      Alexa Auto SDK 2.2.0 - Copyright 2017-2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
      <span style="float:right;">
        Licensed under the <a HREF=http://aws.amazon.com/apache2.0/>Apache License, Version 2.0</a>
      </span>
    </p>
  </body>
</html>
